<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BatchBLAST</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <style>
      body {
        background: linear-gradient(135deg, #eff5ff, #f8f9ff);
        padding: 0.75rem 0;
        font-size: 0.9rem;
        color: #283044;
      }
      .container {
        max-width: 1024px;
        padding: 0 0.75rem;
      }
      .main-panel {
        border: none;
        border-radius: 1rem;
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.1);
        background: #fff;
        margin-top: 0.5rem;
      }
      .main-panel .card-body {
        padding: 1.75rem;
      }
      .sequence-entry {
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        padding: 0.5rem;
        margin-bottom: 0.4rem;
        background: #fff;
        box-shadow: 0 4px 12px rgba(15, 23, 42, 0.05);
      }
      .sequence-row {
        display: flex;
        gap: 6px;
        align-items: center;
      }
      .sequence-input {
        flex: 1;
        min-width: 0;
      }
      .title-input {
        width: 150px;
        min-width: 150px;
      }
      .remove-btn {
        margin-left: 4px;
        padding: 0.2rem 0.4rem;
        font-size: 0.75rem;
        white-space: nowrap;
      }
      .form-control {
        padding: 0.35rem 0.65rem;
        font-size: 0.85rem;
        border-radius: 0.4rem;
      }
      .form-label {
        font-size: 0.78rem;
        margin-bottom: 0.15rem;
        font-weight: 500;
      }
      .quick-config-card {
        border-radius: 0.75rem;
        border: 1px solid rgba(13, 110, 253, 0.1);
        background: linear-gradient(135deg, #f4f7ff, #fefefe);
      }
      .quick-config-card .form-control {
        background: #fff;
      }
      .autosave-status {
        font-size: 0.8rem;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        transition: opacity 0.2s ease;
      }
      .autosave-status .status-icon {
        font-size: 1rem;
      }
      .autosave-status.hidden {
        opacity: 0;
        visibility: hidden;
      }
      .btn-primary, .btn-success {
        border-radius: 999px;
        padding: 0.45rem 1.5rem;
        box-shadow: 0 8px 16px rgba(13, 110, 253, 0.25);
      }
      .upload-area {
        border: 2px dashed #c7d7ff;
        border-radius: 0.75rem;
        padding: 1rem;
        text-align: center;
        background-color: #f8fbff;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 0.9rem;
      }
      .upload-area:hover {
        border-color: #4460f1;
        background-color: #eef3ff;
      }
      .upload-area.dragover {
        border-color: #0d6efd;
        background-color: #e7f1ff;
      }
      .upload-icon {
        font-size: 1.5rem;
        margin-bottom: 0.35rem;
      }

      /* Loading Overlay Styles */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(8px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        flex-direction: column;
      }

      .loading-overlay.active {
        display: flex;
      }

      .loading-content {
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        z-index: 10001;
      }

      /* Standard rotating circle animation */
      .loading-animation {
        width: 60px;
        height: 60px;
        margin: 0 auto 1.5rem;
        position: relative;
      }

      /* Spinner for both div and icon */
      .spinner {
        display: inline-block;
        font-size: 3rem; /* adjust size */
        color: #0d6efd;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .loading-description {
        font-size: 0.9rem;
        color: #6c757d;
        margin-bottom: 1.5rem;
        line-height: 1.4;
        text-align: left;
        max-height: 120px;
        overflow-y: auto;
        padding: 0.5rem;
        background: #f8f9fa;
        border-radius: 0.25rem;
      }

      .loading-description div {
        margin-bottom: 0.3rem;
        padding-bottom: 0.3rem;
        border-bottom: 1px solid #e9ecef;
      }

      .loading-description div:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
      }
      .loading-text {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #343a40;
      }

      .loading-time {
        font-size: 0.8rem;
        color: #868e96;
        font-family: monospace;
        background: #f8f9fa;
        padding: 0.3rem 0.6rem;
        border-radius: 0.25rem;
        display: inline-block;
      }

      .loading-controls {
        margin-top: 1.5rem;
        display: flex;
        gap: 0.5rem;
        justify-content: center;
      }

      .loading-controls .btn {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
      }

      /* Blur effect when loading */
      .content-wrapper {
        transition: filter 0.3s ease;
      }

      .content-wrapper.loading-blur {
        filter: blur(2px);
      }

      pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        background: #f1f3f5;
        padding: 0.25rem;
        border-radius: 0.2rem;
        font-size: 0.75rem;
        margin: 0;
      }
      .upload-area h5 {
        font-size: 0.9rem;
        margin-bottom: 0.2rem;
      }
      .upload-area p {
        font-size: 0.75rem;
        margin-bottom: 0.4rem;
      }
      .sequence-count {
        font-size: 0.75rem;
        color: #6c757d;
        margin-top: 0.2rem;
      }
      .btn-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 0.8rem;
        gap: 0.65rem;
      }
      .btn-sm {
        padding: 0.25rem 0.55rem;
        font-size: 0.78rem;
        border-radius: 999px;
      }
      .preview-title {
        margin-top: 1.2rem;
        padding-bottom: 0.2rem;
        border-bottom: 1px solid #dee2e6;
        font-size: 1rem;
        }
      h1 {
        font-size: 1.6rem;
        margin-bottom: 1rem !important;
        padding: 0 0.5rem;
        font-weight: 600;
      }
      #submitAll {
        padding: 0.5rem 1.8rem;
        font-size: 0.9rem;
        margin: 0.8rem 0;
        box-shadow: 0 10px 20px rgba(35, 137, 255, 0.25);
      }
      .preview-item {
        margin-bottom: 0.3rem;
        padding: 0.3rem;
        background: #f8f9fa;
        border-radius: 0.2rem;
        border-left: 2px solid #0d6efd;
      }
      .preview-item strong {
        font-size: 0.8rem;
      }
      .preview-item code {
        font-size: 0.75rem;
      }
      .compact-grid {
        display: grid;
        grid-template-columns: 150px 1fr auto;
        gap: 6px;
        align-items: end;
      }
      .grid-labels {
        display: grid;
        grid-template-columns: 150px 1fr auto;
        gap: 6px;
        margin-bottom: 0.2rem;
        padding: 0 0.5rem;
      }
      .grid-label {
        font-size: 0.7rem;
        font-weight: 500;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      #entries {
        max-height: 50vh;
        overflow-y: auto;
        border: 1px solid #e9ecef;
        border-radius: 0.375rem;
        padding: 0.5rem;
        background: #fdfdfd;
      }
      .entry-counter {
        font-size: 0.75rem;
        color: #6c757d;
        text-align: center;
        margin-top: 0.3rem;
      }
    </style>
    <style>
      .pdf-frame-wrapper {
        background: #fff;
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid #dee2e6;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .pdf-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: #495057;
        text-align: center;
      }

      .pdf-frame-large {
        width: 100%;
        height: 480px;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        background: #f8f9fa;
      }
      .download-section {
        margin-top: 1.5rem;
        padding: 1.25rem;
        background: linear-gradient(120deg, rgba(76, 201, 240, 0.15), rgba(72, 149, 239, 0.15));
        border-radius: 0.9rem;
        border: 1px solid rgba(56, 189, 248, 0.4);
      }
      .download-buttons {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 0.5rem;
      }
      .download-btn {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        border-radius: 999px;
        padding: 0.35rem 0.9rem;
      }
    </style>
  </head>
  <body>
    <!-- Configuration Modal -->
    <div class="modal fade" id="configModal" tabindex="-1" aria-labelledby="configModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          
          <div class="modal-header">
            <h5 class="modal-title" id="configModalLabel">Configuration</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          
          <div class="modal-body">
            <form id="configForm">
              
              <!-- Database Configuration -->
              <div class="mb-3">
                <label for="dbSelect" class="form-label">BLAST Database</label>
                <select id="dbSelect" class="form-select">
                  <option selected disabled>Select database</option>
                  <option value="nr">nr (largest non-redundant protein)</option>
                  <option value="nt">nt (broad nucleotide collection)</option>
                  <option value="refseq_protein">refseq_protein (curated RefSeq proteins)</option>
                  <option value="refseq_rna">refseq_rna (curated RefSeq RNA sequences)</option>
                  <option value="refseq_genomic">refseq_genomic (curated genomic sequences)</option>
                  <option value="swissprot">swissprot (curated UniProtKB/Swiss-Prot subset mirrored at NCBI)</option>
                  <option value="pdbaa">pdbaa (PDB protein sequences)</option>
                  <option value="pdb">pdb (nucleotide PDB-derived)</option>
                  <option value="env_nr">env_nr (environmental metagenomic protein)</option>
                  <option value="env_nt">env_nt (environmental metagenomic nucleotide)</option>
                  <option value="tsa_nr">tsa_nr (Transcriptome Shotgun Assembly proteins)</option>
                  <option value="tsa_nt">tsa_nt (Transcriptome Shotgun Assembly nucleotides)</option>
                  <option value="wgs">wgs (Whole Genome Shotgun contigs)</option>
                </select>
              </div>
    
              <!-- Program Selection -->
              <div class="mb-3">
                <label for="programSelect" class="form-label">BLAST Program</label>
                <select id="programSelect" class="form-select">
                  <option selected disabled>Select program</option>
                  <option value="blastn">blastn</option>
                  <option value="megablast">megablast</option>
                  <option value="dc-megablast">dc-megablast</option>
                  <option value="blastp">blastp</option>
                  <option value="blastx">blastx</option>
                  <option value="tblastn">tblastn</option>
                  <option value="tblastx">tblastx</option>
                </select>
              </div>

              <div class="mb-3">
                <label for="filterSelect" class="form-label">BLAST Filter</label>
                <select id="filterSelect" class="form-select">
                  <option selected disabled>Select filter</option>
                  <option value="mL">mL</option>
                  <option value="F">F</option>
                  <option value="L">L</option>
                </select>
              </div>
    
              <!-- Output Quantity -->
              <div class="mb-3">
                <label for="outputQty" class="form-label">Output Quantity</label>
                <input type="number" class="form-control" id="outputQty" min="20" placeholder="Enter quantity">
              </div>

            </form>
            <div id="configStatus" class="alert d-none mt-3" role="alert" aria-live="polite"></div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="saveConfig">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-content">
        <div class="loading-animation">
          <i id="loadingIcon" class="bi bi-arrow-repeat spinner"></i>
        </div>

        <div class="loading-text" id="loadingTitle">
          Processing DNA Sequences
        </div>
        <div class="loading-description" id="loadingDescription">
          Analyzing sequences and performing BLAST alignment. This may take a
          few moments...
        </div>

        <div class="loading-time" id="loadingTime">00:00</div>
      </div>
    </div>

    <!-- Content Wrapper for blur effect -->
    <div class="content-wrapper" id="contentWrapper">
      <div class="container mt-2 mb-3">
        <div class="main-panel card shadow-sm">
          <div class="card-body">
        <h1 class="text-center mb-4">BatchBLAST Web UI</h1>

        <div class="quick-config-card card mb-4 border-0">
          <div class="card-body">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3 gap-3">
              <div class="d-flex align-items-center gap-3">
                <div class="rounded-circle bg-primary-subtle text-primary p-3">
                  <i class="bi bi-fingerprint fs-4"></i>
                </div>
                <div>
                  <h5 class="mb-1 fw-semibold">Anomaly Heuristics</h5>
                  <p class="text-muted mb-0">Adjust the keyword and label that drive anomaly detection. Changes auto-save.</p>
                </div>
              </div>
              <div id="heuristicStatus" class="autosave-status hidden text-success">
                <i class="status-icon bi bi-check-circle-fill"></i>
                <span class="status-text">Saved</span>
              </div>
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label text-uppercase text-muted small mb-1" for="nonAnomalyInline">Non-Anomaly Keyword</label>
                <input type="text" id="nonAnomalyInline" class="form-control form-control-lg" placeholder="e.g., sus scrofa">
              </div>
              <div class="col-md-6">
                <label class="form-label text-uppercase text-muted small mb-1" for="speciesNameInline">Report Species Label</label>
                <input type="text" id="speciesNameInline" class="form-control form-control-lg" placeholder="e.g., Swine Surveillance">
              </div>
            </div>
          </div>
        </div>

        <div class="upload-area" id="uploadArea">
          <div class="upload-icon">üìÅ</div>
          <h5>Upload DNA Sequences</h5>
          <p class="text-muted">Drag & drop a FASTA file or click to browse</p>
          <input type="file" id="fastaFile" accept=".fasta,.fa,.txt" hidden />
          <button class="btn btn-primary btn-sm" id="browseBtn">
            Browse Files
          </button>
        </div>

        <div class="grid-labels">
          <div class="grid-label">Title</div>
          <div class="grid-label">DNA Sequence</div>
          <div class="grid-label" style="text-align: center">Action</div>
        </div>

        <div id="entries"></div>
        <div class="entry-counter" id="entryCounter">0 sequences</div>

        <div class="btn-container">
          <button class="btn btn-success btn-sm" id="addEntry">
            ‚ûï Add Sequence
          </button>
          <button class="btn btn-danger btn-sm" id="clearAll">
            üóëÔ∏è Clear All
          </button>
          <!-- Button to trigger modal -->
          <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#configModal">
            Configure Settings
          </button>
        </div>

        <div class="text-center">
          <button class="btn btn-primary" id="submitAll">
            üì§ Start Mass BLAST
          </button>
        </div>

        <h4 class="preview-title">Preview</h4>
        <div id="preview"></div>

        <!-- Download Section (initially hidden) -->
        <div
          class="download-section"
          id="downloadSection"
          style="display: none"
        >
          <h5 class="text-success">‚úÖ Analysis Complete!</h5>
          <p class="mb-2">
            Your DNA sequences have been processed successfully. Download the
            results:
          </p>
          <div class="download-buttons">
            <button
              class="btn btn-success btn-sm download-btn"
              id="downloadFasta"
            >
              <span>üì•</span> FASTA File
            </button>
            <button class="btn btn-info btn-sm download-btn" id="downloadFull">
              <span>üìä</span> PDF Full Report
            </button>
            <button
              class="btn btn-warning btn-sm download-btn"
              id="downloadAnomaly"
            >
              <span>üîß</span> PDF Anomaly Report
            </button>
            <button
              class="btn btn-secondary btn-sm download-btn"
              id="downloadCSV"
            >
              <span>üìÑ</span> All CSV Report
            </button>
          </div>

          <div class="container mt-4" id="pdfpreview">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="pdf-frame-wrapper">
                  <h6 class="pdf-title">Full Report</h6>
                  <iframe
                    id="pdf1"
                    class="pdf-frame-large"
                    title="PDF 1"
                  ></iframe>
                </div>
              </div>
              <div class="col-md-6">
                <div class="pdf-frame-wrapper">
                  <h6 class="pdf-title">Anomaly Report</h6>
                  <iframe
                    id="pdf2"
                    class="pdf-frame-large"
                    title="PDF 2"
                  ></iframe>
                </div>
              </div>
            </div>
          </div>
        </div>
          </div>
        </div>
      </div>
    </div>
    <script src="static/index.js"></script>
  </body>
</html>
